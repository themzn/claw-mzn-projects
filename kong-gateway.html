<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kong Gateway + Monitoring - MZN Projects</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .architecture-diagram {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
        }
        
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            min-width: fit-content;
        }
        
        .flow-box {
            background: var(--accent);
            color: var(--bg);
            padding: 1.5rem;
            border-radius: 8px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .flow-box h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
        }
        
        .flow-box p {
            margin: 0;
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .flow-arrow {
            font-size: 2rem;
            color: var(--accent);
        }
        
        .stack-diagram {
            display: grid;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .stack-layer {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%);
            border-left: 4px solid var(--accent);
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .stack-layer h4 {
            margin: 0 0 0.5rem 0;
            color: var(--accent);
        }
        
        .stack-layer ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
        }
        
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .metric-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin: 0.5rem 0;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .code-block {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .url-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--success);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .url-box strong {
            color: var(--success);
        }
        
        .back-btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: var(--accent);
            color: var(--bg);
        }
        
        .page-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        
        .page-header h1 {
            margin: 0 0 0.75rem 0;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .page-header .subtitle {
            font-size: 1.15rem;
            opacity: 0.95;
            margin: 0;
        }
        
        .badge-container {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>üêµ Kong Gateway + Monitoring</h1>
            <p class="subtitle">Production-Ready API Gateway with Prometheus & Grafana</p>
            <div class="badge-container">
                <span class="badge">‚úÖ SOAP Integration</span>
                <span class="badge">üîê API Key Auth</span>
                <span class="badge">‚è±Ô∏è Rate Limited</span>
                <span class="badge">üìä Real-time Monitoring</span>
            </div>
        </div>

        <a href="index.html" class="back-btn">‚Üê Back to Projects</a>

        <!-- Overview -->
        <section class="content-block">
            <h2>üìã Project Overview</h2>
            <p>Complete Kong Gateway OSS deployment with enterprise-grade monitoring, authentication, rate limiting, and logging capabilities. Fully Dockerized for easy deployment and scaling.</p>
            
            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-label">Status</div>
                    <div class="metric-value">‚úÖ Complete</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Deployment</div>
                    <div class="metric-value">Docker</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Services</div>
                    <div class="metric-value">3</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Mode</div>
                    <div class="metric-value">DB-less</div>
                </div>
            </div>
        </section>

        <!-- Architecture Diagram -->
        <section class="content-block">
            <h2>üèóÔ∏è System Architecture</h2>
            
            <div class="architecture-diagram">
                <h3 style="text-align: center; margin-bottom: 1.5rem;">Request Flow</h3>
                <div class="flow-container">
                    <div class="flow-box">
                        <h4>üì± Client</h4>
                        <p>Mobile/Browser</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Sends API requests</p>
                    </div>
                    
                    <div class="flow-arrow">‚Üí</div>
                    
                    <div class="flow-box">
                        <h4>üêµ Kong Gateway</h4>
                        <p>Port 8000</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">
                            ‚úì Auth Check<br>
                            ‚úì Rate Limit<br>
                            ‚úì Logging
                        </p>
                    </div>
                    
                    <div class="flow-arrow">‚Üí</div>
                    
                    <div class="flow-box">
                        <h4>üéØ Backend API</h4>
                        <p>Kurmi SOAP</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Proxied service</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 2rem 0; font-size: 1.5rem; color: var(--accent);">‚Üì</div>
                
                <h3 style="text-align: center; margin-bottom: 1.5rem;">Monitoring Flow</h3>
                <div class="flow-container">
                    <div class="flow-box">
                        <h4>üêµ Kong</h4>
                        <p>Exposes /metrics</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Prometheus format</p>
                    </div>
                    
                    <div class="flow-arrow">‚Üí</div>
                    
                    <div class="flow-box">
                        <h4>üìä Prometheus</h4>
                        <p>Port 9090</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">
                            Scrapes every 15s<br>
                            15-day retention
                        </p>
                    </div>
                    
                    <div class="flow-arrow">‚Üí</div>
                    
                    <div class="flow-box">
                        <h4>üìà Grafana</h4>
                        <p>Port 3000</p>
                        <p style="margin-top: 0.5rem; font-size: 0.75rem;">
                            Visual dashboards<br>
                            Auto-refresh 5s
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Technical Stack -->
        <section class="content-block">
            <h2>üîß Technical Stack</h2>
            
            <div class="stack-diagram">
                <div class="stack-layer">
                    <h4>üê≥ Container Layer</h4>
                    <ul>
                        <li><strong>Docker Compose:</strong> Multi-container orchestration</li>
                        <li><strong>Private Network:</strong> Isolated kong-net bridge network</li>
                        <li><strong>Volume Mounts:</strong> Persistent data and configuration</li>
                    </ul>
                </div>
                
                <div class="stack-layer">
                    <h4>üêµ API Gateway Layer</h4>
                    <ul>
                        <li><strong>Kong Gateway 3.9.1:</strong> Open-source API gateway</li>
                        <li><strong>DB-less Mode:</strong> Declarative configuration (kong.yml)</li>
                        <li><strong>Plugins:</strong> key-auth, rate-limiting, file-log, prometheus</li>
                    </ul>
                </div>
                
                <div class="stack-layer">
                    <h4>üìä Monitoring Layer</h4>
                    <ul>
                        <li><strong>Prometheus:</strong> Time-series metrics database</li>
                        <li><strong>Grafana 12.4.0:</strong> Visualization and dashboards</li>
                        <li><strong>Auto-provisioned:</strong> Datasource and dashboards pre-configured</li>
                    </ul>
                </div>
                
                <div class="stack-layer">
                    <h4>üéØ Backend Layer</h4>
                    <ul>
                        <li><strong>Kurmi SOAP API:</strong> Target backend service</li>
                        <li><strong>HTTPS Support:</strong> TLS-enabled upstream</li>
                        <li><strong>Timeout Handling:</strong> 60s connect/read/write timeouts</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Features -->
        <section class="content-block">
            <h2>‚ú® Key Features</h2>
            
            <div class="features-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--success);">
                    <h4 style="margin: 0 0 0.5rem 0;">üîó Kurmi SOAP Integration</h4>
                    <p>Automatic REST ‚Üí SOAP transformation</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>Simple GET returns version</li>
                        <li>Credentials injected automatically</li>
                        <li>Full SOAP envelope generation</li>
                        <li>Client-side simplicity</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">üîê Authentication</h4>
                    <p>API key-based authentication with consumer tracking</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>Header or query parameter</li>
                        <li>Consumer: mohammed</li>
                        <li>Credential hiding support</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">‚è±Ô∏è Rate Limiting</h4>
                    <p>5 requests/minute per consumer protection</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>Local policy (in-memory)</li>
                        <li>Per-consumer tracking</li>
                        <li>HTTP 429 on limit exceeded</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">üìù Request Logging</h4>
                    <p>Full request/response logging to file</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>JSON format logs</li>
                        <li>Consumer identification</li>
                        <li>Latency tracking</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">üìä Prometheus Metrics</h4>
                    <p>Comprehensive monitoring metrics</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>HTTP request counters</li>
                        <li>Latency histograms</li>
                        <li>Bandwidth tracking</li>
                        <li>Status code distribution</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">üìà Grafana Dashboards</h4>
                    <p>Pre-configured visual monitoring</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>Real-time request graphs</li>
                        <li>Status code pie charts</li>
                        <li>Latency trends</li>
                        <li>Auto-refresh every 5s</li>
                    </ul>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin: 0 0 0.5rem 0;">üîß DB-less Mode</h4>
                    <p>No database required</p>
                    <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                        <li>Declarative kong.yml config</li>
                        <li>Version controllable</li>
                        <li>Easy replication</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Access URLs -->
        <section class="content-block">
            <h2>üåê Access URLs</h2>
            
            <div class="url-box">
                <strong>Kurmi Version API (SOAP Integration):</strong><br>
                <code>http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025</code><br>
                <small>Returns: &lt;kurmiVersion&gt;8.1.0.01&lt;/kurmiVersion&gt;</small>
            </div>
            
            <div class="url-box">
                <strong>Kong Admin API:</strong><br>
                <code>http://89.167.90.116:8001/status</code>
            </div>
            
            <div class="url-box">
                <strong>Prometheus:</strong><br>
                <code>http://89.167.90.116:9090</code>
            </div>
            
            <div class="url-box">
                <strong>Grafana Dashboard:</strong><br>
                <code>http://89.167.90.116:3000</code><br>
                <small>Login: admin / noaiwithoutapi</small>
            </div>
        </section>

        <!-- Configuration -->
        <section class="content-block">
            <h2>‚öôÔ∏è Configuration</h2>
            
            <h3>Service Details</h3>
            <div class="code-block">
                <code>
Service: kurmi-api<br>
Backend: https://mzn.kurmi-lab.com<br>
Route: /kurmi<br>
Protocol: HTTPS<br>
Timeout: 60 seconds (connect/read/write)<br>
Retries: 5
                </code>
            </div>
            
            <h3>Consumer & Credentials</h3>
            <div class="code-block">
                <code>
Username: mohammed<br>
Custom ID: mohammed-kurmi-presales<br>
API Key: kurmi-presales-2025<br>
Rate Limit: 5 requests/minute
                </code>
            </div>
            
        </section>

        <!-- Plugins Architecture -->
        <section class="content-block">
            <h2>üîå Kong Plugins Architecture</h2>
            <p>Our Kong Gateway uses 5 strategic plugins to provide authentication, rate limiting, monitoring, logging, and SOAP transformation capabilities.</p>
            
            <div style="display: grid; gap: 1.5rem; margin-top: 2rem;">
                <!-- Plugin 1: key-auth -->
                <div style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%); border-left: 5px solid #3b82f6; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin: 0 0 0.75rem 0; color: #3b82f6; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üîê</span> key-auth Plugin
                    </h3>
                    <p style="margin-bottom: 1rem;"><strong>Purpose:</strong> Client-side API key authentication</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <strong>Configuration:</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                            <li><code>key_names: ["apikey"]</code> - Header/query parameter name</li>
                            <li><code>key_in_header: true</code> - Accept API key in headers</li>
                            <li><code>key_in_query: true</code> - Accept API key in URL params</li>
                        </ul>
                    </div>
                    <p><strong>How it works:</strong> Validates incoming requests against consumer credentials. Returns <code>401 Unauthorized</code> if API key is missing or invalid.</p>
                    <p><strong>Use case:</strong> Protects all Kurmi endpoints. Clients must provide <code>apikey: kurmi-presales-2025</code> to access any route.</p>
                </div>

                <!-- Plugin 2: rate-limiting -->
                <div style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%); border-left: 5px solid #f59e0b; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin: 0 0 0.75rem 0; color: #f59e0b; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">‚è±Ô∏è</span> rate-limiting Plugin
                    </h3>
                    <p style="margin-bottom: 1rem;"><strong>Purpose:</strong> Prevent API abuse and protect backend resources</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <strong>Configuration:</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                            <li><code>minute: 5</code> - Maximum 5 requests per minute</li>
                            <li><code>policy: local</code> - In-memory counter (fast, no external store)</li>
                            <li><code>limit_by: consumer</code> - Rate limit tracked per API key</li>
                        </ul>
                    </div>
                    <p><strong>How it works:</strong> Tracks request count per consumer per time window. Returns <code>429 Too Many Requests</code> when limit exceeded. Headers include remaining quota.</p>
                    <p><strong>Use case:</strong> Prevents single consumer from overwhelming Kurmi backend. Each API key gets 5 req/min quota independently.</p>
                </div>

                <!-- Plugin 3: file-log -->
                <div style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%); border-left: 5px solid #8b5cf6; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin: 0 0 0.75rem 0; color: #8b5cf6; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üìù</span> file-log Plugin
                    </h3>
                    <p style="margin-bottom: 1rem;"><strong>Purpose:</strong> Persistent request/response logging for debugging and audit trails</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <strong>Configuration:</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                            <li><code>path: /kong-logs/kong-requests.log</code> - Log file location</li>
                            <li><code>reopen: true</code> - Support log rotation</li>
                        </ul>
                    </div>
                    <p><strong>How it works:</strong> Writes JSON-formatted log entry for each request containing: timestamp, consumer, route, latencies, status codes, request/response headers.</p>
                    <p><strong>Use case:</strong> Debug SOAP transformations, track consumer usage patterns, audit API access, analyze performance bottlenecks.</p>
                </div>

                <!-- Plugin 4: prometheus (global) -->
                <div style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%); border-left: 5px solid #10b981; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin: 0 0 0.75rem 0; color: #10b981; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üìä</span> prometheus Plugin (Global)
                    </h3>
                    <p style="margin-bottom: 1rem;"><strong>Purpose:</strong> Expose real-time metrics for monitoring and alerting</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <strong>Configuration:</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                            <li><code>per_consumer: true</code> - Track metrics by API key</li>
                            <li><code>status_code_metrics: true</code> - Count requests by HTTP status</li>
                            <li><code>latency_metrics: true</code> - Record response times</li>
                            <li><code>bandwidth_metrics: true</code> - Track data transfer</li>
                        </ul>
                    </div>
                    <p><strong>How it works:</strong> Exposes <code>/metrics</code> endpoint in Prometheus format. Scraped every 15s by Prometheus server. Powers Grafana dashboards.</p>
                    <p><strong>Use case:</strong> Real-time visibility into Kong health, request rates, error rates, latency percentiles, consumer activity.</p>
                </div>

                <!-- Plugin 5: pre-function -->
                <div style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%); border-left: 5px solid #ef4444; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin: 0 0 0.75rem 0; color: #ef4444; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">üîÑ</span> pre-function Plugin
                    </h3>
                    <p style="margin-bottom: 1rem;"><strong>Purpose:</strong> Custom request transformation via Lua scripting</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <strong>What it does (for Kurmi):</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                            <li>Transforms GET ‚Üí POST method</li>
                            <li>Generates complete SOAP XML envelope</li>
                            <li>Injects backend credentials (hidden from client)</li>
                            <li>Sets SOAP headers (Content-Type, SOAPAction, Content-Length)</li>
                        </ul>
                    </div>
                    <p><strong>How it works:</strong> Executes Lua code in the <code>access</code> phase (before proxying to backend). Uses <code>kong.service.request</code> API to modify outgoing request.</p>
                    <p><strong>Use case:</strong> Enables REST ‚Üí SOAP translation. Client sends simple GET, Kong transforms it into complex SOAP POST with credentials. Makes legacy APIs modern.</p>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <strong style="color: #ef4444;">‚ö†Ô∏è Security Note:</strong> Backend credentials are injected server-side and never exposed to clients. Only Kong has access to SOAP username/password.
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                <h3 style="margin: 0 0 0.5rem 0;">üéØ Plugin Execution Order</h3>
                <p style="margin: 0 0 1rem 0;">Kong executes plugins in a specific priority order:</p>
                <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                    <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 6px; font-weight: bold;">1. key-auth</div>
                    <span style="font-size: 1.5rem;">‚Üí</span>
                    <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 6px; font-weight: bold;">2. rate-limiting</div>
                    <span style="font-size: 1.5rem;">‚Üí</span>
                    <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 6px; font-weight: bold;">3. pre-function</div>
                    <span style="font-size: 1.5rem;">‚Üí</span>
                    <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 6px; font-weight: bold;">4. proxy to backend</div>
                    <span style="font-size: 1.5rem;">‚Üí</span>
                    <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 6px; font-weight: bold;">5. file-log + prometheus</div>
                </div>
                <p style="margin: 1rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Authentication and rate limiting happen before transformation, ensuring only authorized requests are processed.</p>
            </div>
        </section>

        <!-- Metrics Collected -->
        <section class="content-block">
            <h2>üìä Metrics Collected</h2>
            
            <h3>HTTP Request Metrics</h3>
            <ul>
                <li><code>kong_http_requests_total</code> - Total requests by service/route/status code/consumer</li>
                <li><code>kong_nginx_requests_total</code> - Total NGINX-level requests</li>
            </ul>
            
            <h3>Latency Metrics</h3>
            <ul>
                <li><code>kong_kong_latency_ms</code> - Latency added by Kong and plugins</li>
                <li><code>kong_request_latency_ms</code> - Total request latency</li>
                <li><code>kong_upstream_latency_ms</code> - Backend response time</li>
            </ul>
            
            <h3>Bandwidth Metrics</h3>
            <ul>
                <li><code>kong_bandwidth_bytes{direction="ingress"}</code> - Data received from clients</li>
                <li><code>kong_bandwidth_bytes{direction="egress"}</code> - Data sent to clients</li>
            </ul>
            
            <h3>System Metrics</h3>
            <ul>
                <li><code>kong_datastore_reachable</code> - Database health (1 = healthy)</li>
                <li><code>kong_memory_*</code> - Memory usage by component</li>
                <li><code>kong_nginx_connections_*</code> - Connection pool stats</li>
            </ul>
        </section>

        <!-- Kurmi SOAP Integration -->
        <section class="content-block">
            <h2>üîó Kurmi SOAP Integration</h2>
            
            <p>Kong Gateway successfully bridges REST API clients with Kurmi's legacy SOAP backend through automatic request transformation and credential injection.</p>
            
            <h3>How It Works</h3>
            <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                <strong>Client Request (Simple REST):</strong>
                <div class="code-block" style="margin-top: 0.5rem;">
                    <code>
GET http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025
                    </code>
                </div>
                
                <div style="text-align: center; margin: 1rem 0; font-size: 1.5rem; color: var(--accent);">‚Üì</div>
                
                <strong>Kong Transformation (Automatic):</strong>
                <ul style="margin: 0.5rem 0;">
                    <li>‚úÖ Validates API key authentication</li>
                    <li>‚úÖ Checks rate limit (5/min)</li>
                    <li>‚úÖ Transforms GET ‚Üí POST</li>
                    <li>‚úÖ Injects full SOAP XML envelope</li>
                    <li>‚úÖ Adds Kurmi credentials (auto-injected, hidden from client)</li>
                    <li>‚úÖ Sets proper headers (Content-Type, SOAPAction)</li>
                </ul>
                
                <div style="text-align: center; margin: 1rem 0; font-size: 1.5rem; color: var(--accent);">‚Üì</div>
                
                <strong>Backend Request (SOAP):</strong>
                <div class="code-block" style="margin-top: 0.5rem;">
                    <code>
POST https://mzn.kurmi-lab.com:443/Kurmi/APIService<br>
Content-Type: text/xml; charset=utf-8<br>
SOAPAction: GET_KURMI_VERSION<br>
<br>
&lt;soapenv:Envelope xmlns:soapenv="..." xmlns:ns="..."&gt;<br>
&nbsp;&nbsp;&lt;soapenv:Body&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ns:GET_KURMI_VERSION_QUERY_TYPE&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;auth&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;login&gt;[REDACTED]&lt;/login&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;[REDACTED]&lt;/password&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/auth&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Credentials auto-injected by Kong, hidden from client --&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ns:GET_KURMI_VERSION_QUERY_TYPE&gt;<br>
&nbsp;&nbsp;&lt;/soapenv:Body&gt;<br>
&lt;/soapenv:Envelope&gt;
                    </code>
                </div>
                
                <div style="text-align: center; margin: 1rem 0; font-size: 1.5rem; color: var(--accent);">‚Üì</div>
                
                <strong>Response (XML):</strong>
                <div class="code-block" style="margin-top: 0.5rem;">
                    <code>
&lt;status&gt;SUCCESS&lt;/status&gt;<br>
&lt;kurmiVersion&gt;8.1.0.01&lt;/kurmiVersion&gt;
                    </code>
                </div>
            </div>
            
            <h3>Active Endpoint</h3>
            <div class="url-box">
                <strong>Kurmi Version:</strong><br>
                <code>http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025</code><br>
                <small>Returns: Kurmi version 8.1.0.01</small>
            </div>
            
            <h3>Security Model</h3>
            <ul>
                <li><strong>Client Authentication:</strong> API key only (<code>kurmi-presales-2025</code>)</li>
                <li><strong>Backend Authentication:</strong> SOAP credentials injected automatically by Kong</li>
                <li><strong>Credential Isolation:</strong> Client never sees or needs Kurmi username/password</li>
                <li><strong>Rate Protection:</strong> 5 requests/minute prevents backend abuse</li>
            </ul>
            
            <h3>Technical Implementation</h3>
            <ul>
                <li><strong>Plugin:</strong> pre-function (Lua script)</li>
                <li><strong>Route:</strong> <code>/kurmi/version</code> (accepts GET/POST)</li>
                <li><strong>Service:</strong> <code>https://mzn.kurmi-lab.com:443/Kurmi/APIService</code></li>
                <li><strong>Transformation:</strong> Dynamic SOAP envelope generation with embedded credentials</li>
                <li><strong>Headers:</strong> Content-Type, SOAPAction, Content-Length auto-set</li>
            </ul>
            
            <h3>Extensibility</h3>
            <p>This pattern can be replicated for other Kurmi SOAP operations:</p>
            <ul>
                <li><code>/kurmi/customer/:id</code> ‚Üí GET_CUSTOMER_INFO</li>
                <li><code>/kurmi/order</code> ‚Üí CREATE_ORDER</li>
                <li><code>/kurmi/profile</code> ‚Üí UPDATE_PROFILE</li>
            </ul>
            <p>Each endpoint would follow the same architecture: simple REST input ‚Üí automatic SOAP transformation ‚Üí credential injection.</p>
        </section>

        <!-- Deployment Details -->
        <section class="content-block">
            <h2>üöÄ Deployment</h2>
            
            <h3>Server</h3>
            <div class="code-block">
                <code>
IP: 89.167.90.116<br>
OS: Debian 11 (bullseye)<br>
Docker: 29.2.1<br>
Docker Compose: 5.1.0
                </code>
            </div>
            
            <h3>Quick Commands</h3>
            <div class="code-block">
                <code>
# Start all services<br>
cd /root/.openclaw/workspace/kong-gateway-project<br>
docker compose up -d<br>
<br>
# Check status<br>
docker ps<br>
curl http://localhost:8001/status<br>
<br>
# View logs<br>
docker compose logs -f kong<br>
tail -f logs/kong-requests.log<br>
<br>
# Restart services<br>
docker compose restart<br>
<br>
# Stop all<br>
docker compose down
                </code>
            </div>
            
            <h3>File Structure</h3>
            <div class="code-block">
                <code>
kong-gateway-project/<br>
‚îú‚îÄ‚îÄ docker-compose.yml          # Container orchestration<br>
‚îú‚îÄ‚îÄ kong.yml                    # Declarative API config<br>
‚îú‚îÄ‚îÄ prometheus.yml              # Metrics scraping config<br>
‚îú‚îÄ‚îÄ logs/                       # Request logs directory<br>
‚îú‚îÄ‚îÄ prometheus-data/            # Metrics storage<br>
‚îú‚îÄ‚îÄ grafana-data/               # Dashboard storage<br>
‚îú‚îÄ‚îÄ grafana-provisioning/       # Auto-configuration<br>
‚îÇ   ‚îú‚îÄ‚îÄ datasources/            # Prometheus connection<br>
‚îÇ   ‚îî‚îÄ‚îÄ dashboards/             # Pre-loaded dashboards<br>
‚îî‚îÄ‚îÄ *.md                        # Documentation
                </code>
            </div>
        </section>

        <!-- Testing -->
        <section class="content-block">
            <h2>üß™ Testing</h2>
            
            <h3>Test 1: Kurmi Version API (SOAP Integration)</h3>
            <div class="code-block">
                <code>
# Get Kurmi version via Kong gateway<br>
curl http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025<br>
<br>
# Expected response:<br>
# &lt;kurmiVersion&gt;8.1.0.01&lt;/kurmiVersion&gt;<br>
<br>
# Full XML response:<br>
curl -s http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025 | grep kurmiVersion
                </code>
            </div>
            
            <h3>Test 2: Authentication</h3>
            <div class="code-block">
                <code>
# Without API key (should fail with 401)<br>
curl -i http://89.167.90.116:8000/kurmi/version<br>
<br>
# With API key (should succeed)<br>
curl -i http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025
                </code>
            </div>
            
            <h3>Test 3: Rate Limiting</h3>
            <div class="code-block">
                <code>
# Send 6 requests quickly (6th should return 429)<br>
for i in {1..6}; do<br>
&nbsp;&nbsp;curl -s -o /dev/null -w "Request $i: HTTP %{http_code}\n" \<br>
&nbsp;&nbsp;&nbsp;&nbsp;http://89.167.90.116:8000/kurmi/version?apikey=kurmi-presales-2025<br>
done
                </code>
            </div>
            
            <h3>Test 4: Monitoring</h3>
            <div class="code-block">
                <code>
# Check Prometheus targets<br>
curl http://89.167.90.116:9090/targets<br>
<br>
# Query total requests<br>
curl 'http://89.167.90.116:9090/api/v1/query?query=sum(kong_http_requests_total)'<br>
<br>
# View Grafana dashboard<br>
Open: http://89.167.90.116:3000/d/kong-simple/kong-simple-dashboard
                </code>
            </div>
        </section>

        <!-- Use Cases -->
        <section class="content-block">
            <h2>üí° Use Cases</h2>
            
            <ul>
                <li><strong>Kurmi SOAP Integration:</strong> Transform simple REST calls into complex SOAP requests with automatic credential injection. Example: <code>/kurmi/version</code> returns Kurmi version 8.1.0.01 without client knowing SOAP details</li>
                <li><strong>API Management:</strong> Centralized gateway for all microservices and legacy systems</li>
                <li><strong>Security Translation:</strong> Client uses API key, Kong handles backend username/password authentication</li>
                <li><strong>Rate Limiting:</strong> Protect Kurmi backend from abuse (5 requests/minute per consumer)</li>
                <li><strong>Observability:</strong> Monitor SOAP API usage, latency, and success rates in real-time</li>
                <li><strong>SOAP Modernization:</strong> Expose legacy SOAP services as modern REST APIs</li>
                <li><strong>Multi-tenant:</strong> Separate API keys per customer/team accessing same backend</li>
                <li><strong>Request Transformation:</strong> Inject dynamic credentials, headers, and XML bodies automatically</li>
                <li><strong>Development & Testing:</strong> Test SOAP integrations without managing credentials</li>
            </ul>
        </section>

        <!-- Future Enhancements -->
        <section class="content-block">
            <h2>üîÆ Future Enhancements</h2>
            
            <ul>
                <li>Add SSL/TLS termination for HTTPS proxy</li>
                <li>Configure upstream health checks</li>
                <li>Add CORS plugin for browser clients</li>
                <li>Implement OAuth 2.0 authentication</li>
                <li>Set up request/response transformation</li>
                <li>Add IP restriction plugin</li>
                <li>Configure alerting in Prometheus/Grafana</li>
                <li>Migrate to PostgreSQL for production (retain config history)</li>
                <li>Add custom Kong plugins for business logic</li>
                <li>Integrate with ELK stack for log aggregation</li>
            </ul>
        </section>

        <footer>
            <p>Built with AI assistance by MZN</p>
            <p><a href="index.html" class="back-btn">‚Üê Back to Projects</a></p>
        </footer>
    </div>
</body>
</html>
